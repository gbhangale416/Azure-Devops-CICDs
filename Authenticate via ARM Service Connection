- task: AzureCLI@2
  displayName: 'Authenticate via ARM Service Connection'
  inputs:
    azureSubscription: '<Your Azure Service Connection Name>'
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    addSpnToEnvironment: true
    inlineScript: |

      # Do NOT print secrets
      echo "Service Principal authenticated successfully."

      # Get Azure DevOps access token directly (no manual secret handling in Python)
      ADO_TOKEN=$(az account get-access-token \
        --resource 499b84ac-1321-427f-aa17-267ca6975798 \
        --query accessToken -o tsv)

      # Set as secret pipeline variable
      echo "##vso[task.setvariable variable=ADO_ACCESS_TOKEN;isSecret=true]$ADO_TOKEN"
